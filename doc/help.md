# 一.亚马逊美国站爬虫软件设计
## 1.类目
通过爬取亚马逊类目，获得

大类名|类目数|最小类目数
---|---|---
Arts_ Crafts & Sewing|	638|	535
Automotive|	2900	|2538
Baby|	336	|274
Beauty|	358	|298
Camera & Photo	|237|	191
Cell Phones & Accessories|	66|	54
Clothing|	365	|298
Computers & Accessories|	297	|249
Electronics	|1829|	1510
Health & Personal Care|	1054|	875
Home & Kitchen|	2016|	1685
Home Improvement|	1484	|1243
Industrial & Scientific	|3230|	2752
Jewelry|	176|	143
Kitchen & Dining|	935	|804
Musical Instruments|	592|	473
Office Products|	837|	705
Patio_ Lawn & Garden|	551	|459
Pet Supplies|	488	|393
Shoes|	200	|170
Sports & Outdoors|	1688|	1468
Toys & Games|	746	|614
Video Games|	722	|564
Watches|	22|	17
总计|	21767|	18312

## 2.存储（空间）
总共18312个最小类目，每个类目100件商品，根据抓取的存储来看，每个类目一天占用4K的数据库存储空间，本地文件占用92M，计算所得，一天抓取的数据超过180万，占用数据库空间73M，占用本地存储空间1.68T（本地文件要定时清理）

计算所得：
时长 | 数据库数据量| 本地数据量
---|---|---
1天 | 73M|1.68T
一个月| 2.19G|50.4T
一年|26.645G|613.2T

所以存储空间绰绰有余。

## 3.速度（时间）
采用多台机器分配任务，每台机器并行进程任务，缩小时间。

在单台机器上抓取一个类目的时间是（带宽一般家庭）：180秒（更快可弥补暂停时间，则代理IP问题解决较易）

那么一台机器所有类目抓取需要915.6个小时，软件开发后（假设带宽能够支撑并行数）

机器数 | 并行数| 时间
---|---|---
1 | 1|915.6小时
1| 10|91.56小时
1|20|45.78小时
2|10|45.78小时
2|20|22.89小时
5|10|18.31小时
5|20|9.15小时
10|20|4.575小时
20|20|2.28小时

## 局限（反爬）
代理IP数量不够时，并行程序轮询IP时会大概率同时使用同个IP，导致机器人限制，IP随机数选取需要设计。

我们假设在同一时间，一条IP需暂停3秒才符合人类操作，不会被反爬，那么我们计算所得，IP数必然需要大于并行数，且需暂停0-3秒，不暂停时，IP有概率冲突，计算需数学建模（排队论）。


机器数 | 并行数| 时间|IP数最少（时间翻倍）
---|---|---|---
1 | 1|915.6小时|1
1| 10|91.56小时|10
1|20|45.78小时|20
2|10|45.78小时|20
2|20|22.89小时|40
5|10|18.31小时|50
5|20|9.15小时|100
10|20|4.575小时|200
20|20|2.28小时|400


所以如何使时间更短，IP有效利用，建议将IP打到redis形成IP池消息队列，并行程序从redis pop IP，如果没有IP阻塞，取到IP使用完后打到另外一个歇息消息队列里，过期时间1天，开另一程序监控歇息消息队列，如果时间过了1-5秒，把IP放回IP池消息队列,形成每个IP都有足够的歇息时间。（待实现）

# 二.亚马逊美国站爬虫软件使用
## 1.编辑配置文件
```
{
  "company": "智干电子商务有限公司",
  "version": "v1",
  "developer": "陶彦百，陈锦瀚",
  "time": "2016-11",
  "datadir":"G:",
  "ipnum":30,
  "sleep":true,
  "basedb": {
    "host": "192.168.0.152",
    "user": "bai",
    "pwd": "123456",
    "db": "smart_base"
  },
  "ratedb1": {
    "host": "192.168.0.152",
    "user": "bai",
    "pwd": "123456",
    "db": "smart_item1"
  },
  "ratedb2": {
    "host": "192.168.0.152",
    "user": "bai",
    "pwd": "123456",
    "db": "smart_base"
  }
}
```


## 2.
